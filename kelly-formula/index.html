
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Kelly Formula / 凱利公式 － 風險控管</title>
    <meta name="description" content="">

    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="shortcut icon" href="../favicon.ico">

    <link rel="stylesheet" type="text/css" href="../assets/css/screen.css?v=3fdc09fc57">
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic%7COpen+Sans:700,400">

    <link rel="canonical" href="index.html">
    <meta name="referrer" content="origin-when-cross-origin">
    
    <meta property="og:site_name" content="Hello World! I'm Vincent">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Kelly Formula / 凱利公式 － 風險控管">
    <meta property="og:description" content="投資 vs 投機 vs 賭博, 不管你自認為是使用以上三種策略的那一種人, 今天要介紹的是一門讓你在這條路上可以走得更遠、更久的準則－Kelly Formula, 先來上一堂數學課吧!  Kelly Formula b : 賠率 (獲勝後的報償比上本金的比例, ex. 賭上 1 元, 獲勝可拿回 1+b 元) p : 勝率 (獲勝的機率) q : 敗率 (1-p) f : 為使用現有資金應進行投注的比例 Kelly Formula 為求最大期望值時, 應投入的資金比例 (其中 b、p、q 皆為不變常數)  from Wiki   證明 Definition Xn : 表示 經過 n 次賭局後所剩的資金">
    <meta property="og:url" content="http://captainvincent.github.io/kelly-formula/">
    <meta property="article:published_time" content="2016-03-11T10:57:55.000Z">
    <meta property="article:modified_time" content="2016-03-26T17:25:07.000Z">
    <meta property="article:publisher" content="https://www.facebook.com/UndercoverEngineer">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Kelly Formula / 凱利公式 － 風險控管">
    <meta name="twitter:description" content="投資 vs 投機 vs 賭博, 不管你自認為是使用以上三種策略的那一種人, 今天要介紹的是一門讓你在這條路上可以走得更遠、更久的準則－Kelly Formula, 先來上一堂數學課吧!  Kelly Formula b : 賠率 (獲勝後的報償比上本金的比例, ex. 賭上 1 元, 獲勝可拿回 1+b 元) p : 勝率 (獲勝的機率) q : 敗率 (1-p) f : 為使用現有資金應進行投注的比例 Kelly Formula 為求最大期望值時, 應投入的資金比例 (其中 b、p、q 皆為不變常數)  from Wiki   證明 Definition Xn : 表示 經過 n 次賭局後所剩的資金">
    <meta name="twitter:url" content="http://captainvincent.github.io/kelly-formula/">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Captain Vincent">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Hello World! I&#x27;m Vincent",
        "logo": "http://captainvincent.github.io/ghost/img/ghosticon.jpg"
    },
    "author": {
        "@type": "Person",
        "name": "Captain Vincent",
        "image": "http://captainvincent.github.io/content/images/2016/01/--.JPG",
        "url": "http://captainvincent.github.io/author/captain/",
        "sameAs": []
    },
    "headline": "Kelly Formula / 凱利公式 － 風險控管",
    "url": "http://captainvincent.github.io/kelly-formula/",
    "datePublished": "2016-03-11T10:57:55.000Z",
    "dateModified": "2016-03-26T17:25:07.000Z",
    "description": "投資 vs 投機 vs 賭博, 不管你自認為是使用以上三種策略的那一種人, 今天要介紹的是一門讓你在這條路上可以走得更遠、更久的準則－Kelly Formula, 先來上一堂數學課吧!  Kelly Formula b : 賠率 (獲勝後的報償比上本金的比例, ex. 賭上 1 元, 獲勝可拿回 1+b 元) p : 勝率 (獲勝的機率) q : 敗率 (1-p) f : 為使用現有資金應進行投注的比例 Kelly Formula 為求最大期望值時, 應投入的資金比例 (其中 b、p、q 皆為不變常數)  from Wiki   證明 Definition Xn : 表示 經過 n 次賭局後所剩的資金"
}
    </script>

    <meta name="generator" content="Ghost 0.9">
    <link rel="alternate" type="application/rss+xml" title="Hello World! I'm Vincent" href="../rss/index.html">
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-73341093-1', 'auto');
  ga('send', 'pageview');

</script>
</head>
<body class="post-template nav-closed">

    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="index.html#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
            <li class="nav-blog-home-page" role="presentation"><a href="../">Blog Home Page</a></li>
            <li class="nav-git-book" role="presentation"><a href="https://www.gitbook.com/@captainvincent">Git Book</a></li>
            <li class="nav-aboutme" role="presentation"><a href="https://about.me/CaptainVincent">About.Me</a></li>
    </ul>
        <a class="subscribe-button icon-feed" href="../rss/index.rss">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        


<header class="main-header post-head no-cover">
    <nav class="main-nav  clearfix">
        
            <a class="menu-button icon-menu" href="index.html#"><span class="word">Menu</span></a>
    </nav>
</header>

<main class="content" role="main">
    <article class="post">

        <header class="post-header">
            <h1 class="post-title">Kelly Formula / 凱利公式 － 風險控管</h1>
            <section class="post-meta">
                <time class="post-date" datetime="2016-03-11">11 March 2016</time> 
            </section>
        </header>

        <section class="post-content">
            <blockquote>
  <p>投資 vs 投機 vs 賭博, 不管你自認為是使用以上三種策略的那一種人, 今天要介紹的是一門讓你在這條路上可以走得更遠、更久的準則－<strong>Kelly Formula</strong>, 先來上一堂數學課吧! </p>
</blockquote>

<h2 id="kellyformula">Kelly Formula</h2>

<p><img src="https://farm2.staticflickr.com/1497/25083691774_dba0e65847_o.jpg" alt="Kelly Formula"></p>

<ul>
<li>b : 賠率 (獲勝後的報償比上本金的比例, ex. 賭上 1 元, 獲勝可拿回 1+b 元)</li>
<li>p : 勝率 (獲勝的機率)</li>
<li>q : 敗率 (1-p)</li>
<li>f : 為使用現有資金應進行投注的比例</li>
</ul>

<p>Kelly Formula 為求最大期望值時, 應投入的資金比例 (其中 b、p、q 皆為不變常數) <br>
from <a href="https://zh.wikipedia.org/wiki/%E5%87%B1%E5%88%A9%E5%85%AC%E5%BC%8F">Wiki</a>  </p>

<hr>

<h2 id="">證明</h2>

<p><strong>Definition</strong></p>

<ul>
<li>X<sub>n</sub> : 表示 經過 n 次賭局後所剩的資金 (n=0, 表示初始資金)</li>
<li>W<sub>n</sub> : 表示 經過 n 次賭局, Win 的次數</li>
<li>L<sub>n</sub> : 表示 經過 n 次賭局, Loss 的次數</li>
</ul>

<p><strong>Two Cases</strong></p>

<ul>
<li>X<sub>n</sub> = X<sub>n-1</sub> ( 1 + bf )
Win case, 剩餘金額 = 前次金額 * (1 + 賠率*前次投注的比例)  </li>
<li>X<sub>n</sub> = X<sub>n-1</sub> ( 1 - f )
Loss case, 剩餘金額 = 前次金額 * (1 - 前次損失的比例)</li>
</ul>

<p>更進一步可以理解</p>

<p>X<sub>n</sub> = X<sub>0</sub> ( 1 - f ) <sup>Ln</sup> ( 1 + bf ) <sup>Wn</sup> ... (式1) <br>
剩餘金額 = 初始金額 * (失敗 case)<sup>失敗次數</sup> * (勝利 case)<sup>勝利次數</sup> </p>

<blockquote>
  <p>參考文獻中更進一步的將 Loss Case 中的賠率 (賠給對方), 另外定義為 a, 所以整理得到的公式會如下</p>
  
  <p>X<sub>n</sub> = X<sub>0</sub> ( 1 - af ) <sup>Ln</sup> ( 1 + bf ) <sup>Wn</sup> ... (式2)</p>
  
  <p>而 (式1) 只是當 a=1 的 special case (表示當輸了時, 會造成該次投注金額全部損失)</p>
</blockquote>

<p>Reference <a href="https://www.math.washington.edu/~morrow/336_10/papers/jane.pdf">Betting with the Kelly Criterion</a>, Jane Hung (June 2,2010)</p>

<p>這邊先以 (式2) 來求 f 的最佳值, 首先對 <strong>方程式</strong> 的左右兩側同時</p>

<ol>
<li>除以 X<sub>0</sub>  </li>
<li>取 ln (ln = log<sub>e</sub>) <br>
因為 ln 為嚴格遞增函數, 所以對 <strong>方程式</strong> 兩側作用後, 不影響求極大值的條件。
(若 x<sub>1</sub>、x<sub>2</sub> 為實數 且 x<sub>1</sub>&gt;x<sub>2</sub>, 則 f(x<sub>1</sub>) &gt; f(x<sub>2</sub>)恆成立, 滿足此條件的 f(x) 稱為 <strong>嚴格遞增函數</strong>)</li>
<li>除以 n (當 n&gt;0 時, 也可視為嚴格遞增)</li>
</ol>

<p>透過使用下列對數律</p>

<ul>
<li>log<sub>a</sub> X*Y = log<sub>a</sub> X + log<sub>a</sub> Y</li>
<li>b * log<sub>a</sub> X = log<sub>a</sub> X <sup>b</sup></li>
</ul>

<p>化簡後如下 ... (式3)
<img src="https://farm2.staticflickr.com/1669/25690346716_7d44c0666a.jpg" alt="Step1"></p>

<p>新定義一個函式為 G(f) = (式3), 因 L<sub>n</sub> / n = q、W<sub>n</sub> / n = p (來自於 p、q 本身的定義為勝率跟敗率), 所以得到</p>

<p>G(f) = q (ln (1-af)) + p (ln (1+bf))</p>

<p><strong>目前問題已經轉化為要求 G(f) 的最大值時, f 應該使用多少?</strong></p>

<p>這邊一階微分在數學上的意義是斜率, 所以當我們今天要找極大值相當於我們要找出斜率 = 0 的點, 所以我們先找出 G'(f) = 0 的 f 值有哪些? </p>

<p>使用 <a href="https://en.wikipedia.org/wiki/Chain_rule">Chain Rule</a> 技巧可以得到下面結果</p>

<p><img src="https://farm2.staticflickr.com/1702/25719192595_02cd415376_n.jpg" alt="Step2"></p>

<p><img src="https://farm2.staticflickr.com/1703/25418464200_564ea61514_n.jpg" alt="Step3"></p>

<p>因為分母 =\= 0, 所以這邊僅需要求分子 <strong>bp - aq- abf = 0</strong> 的 f 解, 透過移項後即可得到 G(f) 的極值出現在 f 為何時 (當然這邊其實還要用二階微分來求函數的凹性, 確認求出的 f 值代入 G(f) 是極大還是極小值, 但這邊省略請直接參考 <a href="https://www.math.washington.edu/~morrow/336_10/papers/jane.pdf">Jane 的文獻</a>)</p>

<p><img src="https://farm2.staticflickr.com/1481/25719324655_119cc96a22_m.jpg" alt="Step4"></p>

<p>得到 (式2) 的解後, 就可以知道 (式1) 得到的 Kelly Fromula 僅是當 a 為 1 時的特殊解。</p>

<p><a href="https://www.symbolab.com">推薦Online好用的數學工具</a></p>

<hr>

<h2 id="thestockmarket">The Stock Market</h2>

<p>股票市場上的賭局並非使用固定的賠率看待, 所以這邊引入了隨機變數的概念, 用 <strong>X</strong> 表示每單位可拿回的金額 (相當於之前 Kelly Formula 裡的賠率 b), P(X = s) 則表示當 X 為 s 時發生的機率。</p>

<p><a href="http://ccckmit.wikidot.com/st:randomvariable">隨機變數參考網站</a></p>

<p>又因為今天在設法求出最佳投注資金比例 f 時, 重點不在於整個市場的機率分佈呈現是如何, 所以對機率分佈上做了以下的假設</p>

<p><code>P(X = μ + σ) = P(X = μ − σ) = 0.5 ... (式4)</code></p>

<ul>
<li>μ 為平均值</li>
<li>σ 為標準差</li>
</ul>

<p><strong>而在資金 Y 變化的公式則是由下式表示</strong></p>

<p>Y<sub>n</sub> = Y<sub>n-1</sub> (1 + (1-f)r + fX), <em>(r 表示 <strong>未</strong> 進行投注的資金獲得的報償比例)</em></p>

<p>解讀為</p>

<pre><code>現有剩餘資金 = 前次剩餘資金*(1 + 未投注市場比例*未投注報償比 + 投注市場比例*投注市場報償比) 
</code></pre>

<p>當今天進行了 n 次的投注後, 嘗試列出 <strong>現有資金</strong> 與 <strong>初始資金</strong> 間的關係, 所以這邊重新做了一次以下的假設, 使得我們經過 n 次投注後得到的總 μ, σ<sup>2</sup> and r 仍相同 (意味要將 μ, σ<sup>2</sup> and r 平均分散在 n 次的投注中)</p>

<ul>
<li><p>標準差 σ'
<img src="https://farm2.staticflickr.com/1651/25203896753_b1333171ea_t.jpg" alt="Step5">
(因為要令 σ'<sup>2</sup> * n = σ<sup>2</sup>)</p></li>
<li><p>回報率 μ'
<img src="https://farm2.staticflickr.com/1692/25830684445_9488841440_t.jpg" alt="Step6">
(因為要令 μ'* n = μ)</p></li>
<li><p>其他投資回報率 r'
<img src="https://farm2.staticflickr.com/1565/25200176134_81d6ea1236_t.jpg" alt="Step7">
(因為要令 r'* n = r)</p></li>
<li><p>將以上的變量代入一開始假設的機率分佈
<img src="https://farm2.staticflickr.com/1506/25200176174_cd81ae121e.jpg" alt="Step8"></p></li>
</ul>

<p>可以導出 Y<sub>n</sub> 與 Y<sub>0</sub> 的關係式
<img src="https://farm2.staticflickr.com/1579/25202372904_2b2901e3d6_n.jpg" alt="Step9"></p>

<p>將 Y<sub>0</sub> 移項至左式, 再兩邊同取 ln 後
<img src="https://farm2.staticflickr.com/1520/25738035291_dc778d991b.jpg" alt="Step10"></p>

<blockquote>
  <p>回到 Kelly Formula 的討論, 我們仍是要求 G<sub>n</sub>(f) 的極大值出現在 f (資金下注比例) 為何時?</p>
</blockquote>

<p>在這部分的推導上是先將 G<sub>n</sub>(f) 以 Maclaurin 級數展開, 並令 n-&gt;∞ 時對多項式來求極值。</p>

<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/138186136@N06/25254483243/in/dateposted-public/" title="Step11"><img src="https://farm2.staticflickr.com/1550/25254483243_fae5dae26b.jpg" align="center" width="375" height="500" alt="Step11"></a><script async src="http://embedr.flickr.com/assets/client-code.js" charset="utf-8"></script> <br>
(詳細的步驟可以參考我的計算過程, 跟 Jane 的有些微出入, 我猜她可能沒有實際推導後面的展開式, 所以才會在微分的結果上寫錯)</p>

<p>最後我們總算可以導出適用於市場的 Kelly Criterion。
<img src="https://farm2.staticflickr.com/1518/25883526085_a10a0e006e_o.jpg" alt="Step12"></p>
        </section>

        <footer class="post-footer">


            <figure class="author-image">
                <a class="img" href="../author/captain/" style="background-image: url(../content/images/2016/01/--.JPG)"><span class="hidden">Captain Vincent's Picture</span></a>
            </figure>

            <section class="author">
                <h4><a href="../author/captain/">Captain Vincent</a></h4>

                    <p>Read <a href="../author/captain/">more posts</a> by this author.</p>
                <div class="author-meta">
                    
                    
                </div>
            </section>


            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="https://twitter.com/intent/tweet?text=Kelly%20Formula%20%2F%20%E5%87%B1%E5%88%A9%E5%85%AC%E5%BC%8F%20%EF%BC%8D%20%E9%A2%A8%E9%9A%AA%E6%8E%A7%E7%AE%A1&amp;url=http://captainvincent.github.io/kelly-formula/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://captainvincent.github.io/kelly-formula/index.html" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://captainvincent.github.io/kelly-formula/" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>


            <div id="disqus_thread"></div>
            <script>
            /**
            * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
            * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
            */

            var disqus_config = function () {
                this.page.url = 'http://captainvincent.github.io/kelly-formula/'; // Replace PAGE_URL with your page's canonical URL variable
                this.page.identifier = 'ghost-14'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
            };

            (function() { // DON'T EDIT BELOW THIS LINE
                var d = document, s = d.createElement('script');

                s.src = '//captainvincent.disqus.com/embed.js';

                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


        </footer>

    </article>
</main>

<aside class="read-next">
    <a class="read-next-story no-cover" href="../dao-shi-li-lun-de-21-zhao-xuan-gu-ji-qiao/">
        <section class="post">
            <h2>道氏理論的 21 招選股技巧 筆記 (Mind Map)</h2>
            <p>原著：道氏理論的21招選股技巧 陳東 (2012/04/01)   History repeats itself. 技術面操盤者心中共同的信念。 關於 Mind Map 內的筆記整理, 是筆者消化後認為有可能後續實驗可以參考的法則, 有可能並未忠實呈現道氏理論原先的面貌 (或本書作者的完整意思), 像道氏理論中對於各技術分析的指標都會強調求出其三重型態或是至少求出中、短期的線圖,…</p>
        </section>
    </a>
    <a class="read-next-story prev no-cover" href="../hai-gui-te-xun-ban/">
        <section class="post">
            <h2>海龜特訓班 筆記 (Mind Map)</h2>
            <p>原名      The Complete TurtleTrader by Michael W. Covel      這是一部關於 理察.丹尼斯 (Richard Dennis) 訓練雜牌軍成為百萬交易員的故事(1983-1984)。不過絕大部分都被我在筆記中省略了 (笑)。 由來 海龜…</p>
        </section>
    </a>
</aside>



        <footer class="site-footer clearfix">
            <section class="copyright"><a href="../">Hello World! I'm Vincent</a> © 2016</section>
            <section class="poweredby">Proudly published with <a href="https://ghost.org">Ghost</a></section>
        </footer>

    </div>

    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
    
    <script type="text/javascript" src="../assets/js/jquery.fitvids.js?v=3fdc09fc57"></script>
    <script type="text/javascript" src="../assets/js/jquery.fitvids.js?v=3fdc09fc57"></script>
    <script type="text/javascript" src="../assets/js/prism.js?v=3fdc09fc57"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$','$'], ['\\\\(','\\\\)']],
                processEscapes: true
            }
        });
    </script>
    <script type="text/javascript" src="../assets/js/index.js?v=3fdc09fc57"></script>

</body>
